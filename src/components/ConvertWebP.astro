<div class="flex justify-center mt-10">
  <div class="card w-full max-w-md bg-base-100 shadow-xl">
    <div class="card-body text-center">

      <!-- Titolo -->
      <h2 class="card-title justify-center text-xl">
        üñºÔ∏è Convertitore Immagini
      </h2>
      <p class="text-base-content/70 mb-4">
        Carica un'immagine e scaricala in formato WebP
      </p>

      <!-- Input file -->
      <input
        id="imageInput"
        type="file"
        accept="image/*"
        class="file-input file-input-accent w-full max-w-xs mb-4"
      />

      <!-- Bottone download -->
      <button
        id="downloadBtn"
        class="btn btn-primary w-full max-w-xs mb-4"
        disabled
      >
        Scarica WebP
      </button>

      <!-- Preview immagine -->
      <div class="overflow-hidden rounded-lg bg-base-200 p-2">
        <img
          id="preview"
          style="max-width: 100%; max-height: 300px; margin-top: 0.5rem;"
          alt="Preview immagine"
        />
      </div>

    </div>
  </div>
</div>

<script>
    // image-converter.ts
const input = document.getElementById("imageInput") as HTMLInputElement;
const downloadBtn = document.getElementById("downloadBtn") as HTMLButtonElement;
const preview = document.getElementById("preview") as HTMLImageElement;

let webpBlob: Blob | null = null;

input.addEventListener("change", async () => {
  const file = input.files?.[0];
  if (!file) return;

  const img = new Image();
  const reader = new FileReader();

  reader.onload = () => {
    if (typeof reader.result === "string") {
      img.src = reader.result;
    }
  };

  img.onload = () => {
    const canvas = document.createElement("canvas");
    canvas.width = img.width;
    canvas.height = img.height;

    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    ctx.drawImage(img, 0, 0);

    canvas.toBlob(
      (blob) => {
        if (!blob) return;
        webpBlob = blob;
        downloadBtn.disabled = false;
        preview.src = URL.createObjectURL(blob);
      },
      "image/webp",
      0.8 // qualit√† tra 0 e 1
    );
  };

  reader.readAsDataURL(file);
});

downloadBtn.addEventListener("click", () => {
  if (!webpBlob) return;

  const a = document.createElement("a");
  a.href = URL.createObjectURL(webpBlob);
  a.download = "converted.webp";
  a.click();
});

</script>